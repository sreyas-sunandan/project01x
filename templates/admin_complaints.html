{% include "admin_header.html" %}

<main class="admin_content">

  <!-- PAGE HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">ğŸ“¨ User Complaints</h2>
      <p class="text-muted mb-0">
        View user complaints and reply directly
      </p>
    </div>
  </div>

  <!-- COMPLAINT TABLE -->
  <table class="table table-dark table-striped align-middle">
    <thead class="text-center">
      <tr>
        <th>#</th>
        <th>User</th>
        <th>Subject</th>
        <th>Complaint</th>
        <th>Admin Reply</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody>
      {% for c in complaints %}
      <tr>
        <td class="text-center">{{ forloop.counter }}</td>
        <td class="text-center">{{ c.user.username }}</td>
        <td>{{ c.subject }}</td>
        <td>{{ c.message }}</td>

        <td>
          {% if c.admin_reply %}
            {{ c.admin_reply }}
          {% else %}
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="complaint_id" value="{{ c.id }}">
              <textarea name="reply"
                        class="form-control mb-2"
                        rows="2"
                        placeholder="Type reply..."
                        required></textarea>
              <button class="btn btn-success btn-sm">
                Reply
              </button>
            </form>
          {% endif %}
        </td>

        <td class="text-center">
          <span class="badge
            {% if c.status == 'open' %}bg-warning
            {% elif c.status == 'replied' %}bg-success
            {% else %}bg-secondary{% endif %}">
            {{ c.get_status_display }}
          </span>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center">
          No complaints found
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

</main>

